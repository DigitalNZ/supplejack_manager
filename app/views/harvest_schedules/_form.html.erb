<%= form_with model: @harvest_schedule, html: { class: "harvest_schedule" }, local: true do |f| %>

  <%= f.label :parser_id, 'Parser Script' %>
  <%= f.select :parser_id, @parsers.map { |parser| [parser.name, parser.id] }, include_blank: true %>

  <%= f.label :start_time %>
  <%= f.datetime_field :start_time, input_html: { class: "datetimepicker", value: @harvest_schedule.start_time.present? ? l(@harvest_schedule.start_time) : nil } %>

  <div class="grid-x">
    <%= f.label :recurrent do %>
      <%= f.check_box :recurrent %> Recurrent
    <% end %>
  </div>

  <br/>

  <ul class="tabs" data-tabs id="example-tabs">
    <%= content_tag :li, class: "tabs-title #{@harvest_schedule.simple? ? "is-active" : nil }" do %>
      <a data-tabs-target="simple-schedule-tab" href="#simple-schedule-tab">Simple Schedule</a>
    <% end %>

    <%= content_tag :li, class: "tabs-title #{!@harvest_schedule.simple? ? "is-active" : nil }" do %>
      <a data-tabs-target='cron-syntax-tab' href="#cron-syntax-tab" aria-selected="true">Cron Syntax</a>
    <% end %>
  </ul>

  <%= tag.div(id: "recurrent-options", style: @harvest_schedule.recurrent ? "" : "display: none") do %>

    <div class="tabs-content" data-tabs-content='example-tabs'>

      <%= content_tag :div, id: "simple-schedule-tab", class: "tabs-panel #{@harvest_schedule.simple? ? "is-active" : nil }" do %>
        <%= f.collection_select :frequency, ["daily", "weekly", "fortnightly", "monthly"].map { |o| [o, o.capitalize] }, :first, :second %>

        <div class="input string optional harvest_schedule_at_hour">
          <%= f.label :at_hour %>
          <div class="grid-x">
            <div class="medium-2 cell"><%= f.collection_select :at_hour, (0..23).map { |n| n.to_s.rjust(2, "0") }, :to_s, :to_s %></div>
            <div class="medium-2 cell"><%= f.collection_select :at_minutes, (0..55).step(5).map { |n| n.to_s.rjust(2, "0") }, :to_s, :to_s %></div>
            <div class="medium-10 cell"></div>
          </div>
        </div>

        <%= f.number_field :offset, hint: t("harvest_schedules.offset_hint") %>
      <% end %>

      <%= content_tag :div, id: "cron-syntax-tab", class: "tabs-panel #{!@harvest_schedule.simple? ? "is-active" : nil}" do %>
        <%= f.text_field :cron %>
      <% end %>

    </div>
  <% end %>

  <%= f.hidden_field :environment %>

  <%= render "mode", { harvest_schedule: @harvest_schedule }  %>

  <%= render "enrichments", { harvest_schedule: @harvest_schedule, environment: params[:environment]  }  %>

  <br/>

  <%= f.submit t('harvest_schedules.save'), class: "button float-right" %>
<% end %>
